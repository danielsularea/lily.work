!function(t){"use strict";var a,e=window.Main||{},d=e.settings={headerScroll:"js--headerScroll",staticryptForm:"js--staticryptForm",staticryptInsertHeader:"js--staticryptInsertHeader",staticryptInsertArticle:"js--staticryptInsertArticle",staticryptAlert:"js--staticryptAlert",workMenu:"js--workMenu",workMenuLink:"js--workMenuLink",zoomImages:"js--zoom",zoomImagesWidth:"js--zoomWidth"},m="lilychen",o=function(t,e){var n=document.documentElement.offsetHeight-window.innerHeight;n<=t?t=n:t<=0&&(t=0);var s=(t-window.scrollY)/e*10;setTimeout(function(){window.scrollTo(window.scrollX,window.scrollY+s),window.scrollY!==t&&o(t,e-10)},10)},l=function(t){if(t)return t.getBoundingClientRect().top+(window.pageYOffset||document.documentElement.scrollTop)},f=function(t,e){var n=t.dataset.header,s=t.dataset.articleBefore,o=t.dataset.articleAfter;t.remove();var r=document.getElementsByClassName(d.staticryptInsertHeader),i=document.getElementsByClassName(d.staticryptInsertArticle);r[0]&&r[0].insertAdjacentHTML("beforeend",n),i[0]&&i[0].insertAdjacentHTML("beforeend",s+marked(e)+o)},s=function(){var t=document.getElementsByClassName(d.staticryptForm);if(t[0]){var e=sessionStorage.getItem(m);if(e){var n=t[0],s=n.dataset.encrypted,o=s.substring(0,64),r=s.substring(64);CryptoJS.HmacSHA256(r,CryptoJS.SHA256(e).toString()).toString()===o&&f(n,CryptoJS.AES.decrypt(r,e).toString(CryptoJS.enc.Utf8))}}},n=function(){a={exists:!1,element:void 0,offsetY:0,links:{},refs:{}};var t=document.getElementsByClassName(d.workMenu);if(t[0]){var e=t[0],n=e.dataset.offsety?e.dataset.offsety:0;a.exists=!0,a.element=t[0],a.offsetY=n;for(var s=document.querySelectorAll("."+d.workMenu+" a"),o=0;o<s.length;o++){var r=s[o].getAttribute("href").split("#")[1],i=document.getElementById(r);a.links[r]=s[o],a.refs[r]=i}}},u=function(){n(),function(){var t=document.getElementsByClassName(d.zoomImages);if(t[0])for(var e=0;e<t.length;e++){var n=t[e].querySelector("figcaption");n&&(n.style.marginLeft="0"),t[e].style.width="100%",t[e].style.marginLeft="0",t[e].classList.remove("m--zoomImage-open")}}()},r=function(){if(a.exists){var t=a.element,e=t.parentNode,n=e.offsetTop,s=a.offsetY,o=window.pageYOffset||document.documentElement.scrollTop;l(e);t.style.opacity=n-s-75<=o?1:0,n-o<=s?(t.style.width=e.offsetWidth+"px",t.style.position="fixed",t.style.top=s+"px"):(t.style.width="auto",t.style.position="static")}},i=function(t){if(a.exists){t.preventDefault();var e=t.target.getAttribute("href").split("#")[1],n=a.refs[e],s=parseInt(l(n))-a.offsetY;t.target.blur(),o(s,300)}},c=function(t){t.preventDefault();var e=document.getElementsByClassName(d.staticryptForm);if(e[0]){var n=e[0],s=n.querySelectorAll('[type="password"]'),o=n.querySelectorAll('[type="submit"]');if(s[0]&&o[0]){var r=s[0].value,i=n.dataset.encrypted,a=i.substring(0,64),l=i.substring(64);if(CryptoJS.HmacSHA256(l,CryptoJS.SHA256(r).toString()).toString()!==a){var c=document.getElementsByClassName(d.staticryptAlert);return c[0]?c[0].classList.remove("u--noDisplay"):alert("Bad passphrase!"),void s[0].select()}sessionStorage.setItem(m,r.toString()),f(n,CryptoJS.AES.decrypt(l,r).toString(CryptoJS.enc.Utf8)),u(),w()}}},p=function(){if(a.exists){a.element;var t=window.pageYOffset||document.documentElement.scrollTop,e=function(){var t={};for(var e in a.refs){var n=parseInt(l(a.refs[e]));t[e]=n-a.offsetY}return t}(),n=document.documentElement.offsetHeight-window.innerHeight;for(var s in a.links){var o=a.links[s].parentNode.classList;if(o.contains(d.workMenuLink)){var r=e[s];if(o.remove("active"),r-1<=t||n<=t){for(var i in a.links)a.links[i].parentNode.classList.remove("active");o.add("active")}}}}},g=function(t){var e=document.getElementsByClassName(d.zoomImagesWidth);if(e[0]){var n=t.querySelector("figcaption");if(t.classList.contains("m--zoomImage-open"))return n&&(n.style.marginLeft="0"),t.style.width="100%",t.style.marginLeft="0",void t.classList.remove("m--zoomImage-open");t.classList.add("m--zoomImage-open");var s=e[0].offsetWidth,o=t.getBoundingClientRect().left-e[0].getBoundingClientRect().left;n&&(n.style.marginLeft=o+"px",n.style.width=t.clientWidth+"px"),t.style.width=s+"px",t.style.marginLeft="-"+o+"px"}},y=function(){u(),r()},v=function(){!function(){var t=document.getElementsByClassName(d.headerScroll);if(t[0]){var e=t[0];0<(window.pageYOffset||document.documentElement.scrollTop)?e.classList.add("fixed"):e.classList.remove("fixed")}}(),r(),p()},w=function(){for(var t in window.addEventListener("resize",y),document.addEventListener("scroll",v),document.addEventListener("submit",c),a.links)a.links[t].addEventListener("click",i);for(var e=document.getElementsByClassName(d.zoomImages),n=0;n<e.length;n++)e[n].classList.add("m--zoomImage"),e[n].addEventListener("click",function(){g(this)})};e._init=function(){Barba.Pjax.getTransition=function(){return Transition},document.addEventListener("DOMContentLoaded",function(t){Barba.Pjax.start()}),Barba.Dispatcher.on("transitionCompleted",function(t,e,n){s(),u(),w()}),s(),u()},e._init()}();